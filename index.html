<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZBcoin â€“ Royal Flip</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#070B18; --panel:#0C1430B3; --ink:#E9F1FF; --muted:#A7B8FF;
  --accent:#2F80ED; --ok:#27C46B; --depth:18px;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:
    radial-gradient(1400px 900px at 50% -10%, #1A2A63 0%, #0E1A43 40%, #070B18 70%) fixed,
    radial-gradient(800px 400px at 80% 20%, #143B88 0%, transparent 60%) fixed,
    radial-gradient(700px 600px at 10% 80%, #0F5EA2 0%, transparent 60%) fixed;
}
.card{width:min(980px,96%); margin:26px auto; background:var(--panel); border:1px solid #ffffff1f;
  border-radius:20px; box-shadow:0 20px 80px #0009; backdrop-filter:blur(12px) saturate(130%)}
.header{display:flex;align-items:center;gap:12px;padding:16px 18px;border-bottom:1px solid #ffffff12}
.brandWrap{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#FF7A36,#FF4E36);
  display:grid;place-items:center;overflow:hidden;flex:0 0 36px;box-shadow:0 6px 16px #0008,inset 0 0 8px #ffffff55}
.brand{width:90%;height:90%;object-fit:contain;filter:drop-shadow(0 2px 2px #0006)}
.h1{font-weight:800;font-size:20px;margin-right:auto}
.pill{display:inline-flex;gap:8px;align-items:center;background:#0E1A43;border:1px solid #ffffff1f;
  padding:8px 12px;border-radius:999px;font-weight:800}
.panel{padding:18px}
.title{margin:0 0 8px;font-weight:800}
.center{display:grid;place-items:center}
.row{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap}
.btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer;
  background:#182659;color:#dfe8ff;transition:transform .04s ease,filter .2s}
.btn.primary{background:linear-gradient(180deg,#3793ff,#2f80ed);color:#fff}
.btn.ok{background:linear-gradient(180deg,#32d97f,#27c46b);color:#061016}
.btn:active{transform:translateY(1px)}
.footer{padding:10px 18px;border-top:1px solid #ffffff12;color:#9db1ff9c;font-size:12px}

/* SAHNE */
.stage{height:456px;position:relative;display:grid;place-items:center;perspective:1600px}
.msg{position:absolute;top:14px;left:50%;transform:translateX(-50%);font-weight:800}
.shadow{position:absolute;bottom:60px;width:300px;height:110px;border-radius:50%;
  background:radial-gradient(ellipse at center,#0008 0%,#0006 45%,#0000 75%);filter:blur(12px);transform-origin:center}

/* ===================== 3D COIN (TURA DÃœZ, Ã‡AKIÅžMA YOK) ===================== */
.coin{position:absolute;width:260px;height:260px;transform-style:preserve-3d;filter:drop-shadow(0 22px 26px #0008)}
.face{
  position:absolute;inset:0;border-radius:50%;
  transform-style:preserve-3d;backface-visibility:hidden;
}
/* yÃ¼zleri mikro ofsetle; z-fighting biter */
.front{
  transform:translateZ(calc(var(--depth) + 0.4px));
  background:radial-gradient(circle at 33% 28%,#fff2a6 0%,#ffd769 40%,#ffc13b 63%,#ffa600 78%,#ff9700 100%);
  border:4px solid #ffb000;
}
.back{
  transform:rotateY(180deg) translateZ(calc(var(--depth) + 0.4px));
  background:radial-gradient(circle at 67% 32%,#e7f0ff 0%,#c7d9ff 40%,#88a8ff 63%,#5d7fff 78%,#3c63ff 100%);
  border:4px solid #6f8fff;
}

/* YazÄ± katmanÄ±: varsayÄ±lanÄ± scaleX(-1) â†’ arka yÃ¼zdeki metin dÃ¼zelir */
.surface{
  position:absolute;inset:0;border-radius:50%;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  transform:scaleX(-1) translateZ(1.2px); /* metni Ã¶ne al + aynayÄ± dÃ¼zelt */
}
.front .surface{ transform:translateZ(1.2px); } /* Ã¶n yÃ¼zde aynalama yok */

.surface .label{font-size:46px;line-height:1;letter-spacing:.6px;font-weight:900;color:#0b0b0b;text-shadow:0 1px 0 #fff9}
.surface .sub{font-size:14px;margin-top:8px;font-weight:700;color:#202020}

/* gÃ¶rÃ¼nmeyen yÃ¼zÃ¼ gizle â€“ animasyon bitince sÄ±nÄ±f ekliyoruz */
.coin.show-yazi .back .surface{visibility:hidden}
.coin.show-tura .front .surface{visibility:hidden}

/* yivli kenar */
.rim{position:absolute;inset:0;border-radius:50%;transform:translateZ(calc(var(--depth) * -1)) rotateY(90deg);
  width:calc(var(--depth) * 2);left:calc(50% - var(--depth));background:repeating-linear-gradient(#c88900 0 6px,#f2b400 6px 12px)}

/* animasyon */
.coin.spinning{filter:drop-shadow(0 22px 26px #0008) blur(.25px)}
.coin.anim{animation:flip var(--dur,1.9s) cubic-bezier(.2,.72,.14,1) forwards}
@keyframes flip{0%{transform:rotateX(0)}100%{transform:rotateX(var(--rotX,1440deg))}}
.coin.wobble{animation:wob .9s ease-out}
@keyframes wob{0%{transform:rotateX(var(--rotX))}30%{transform:rotateX(calc(var(--rotX)+6deg))}60%{transform:rotateX(calc(var(--rotX)-3deg))}100%{transform:rotateX(var(--rotX))}}

/* confetti */
.confetti{position:fixed;width:8px;height:14px;border-radius:1px;top:-20px;left:0;pointer-events:none;z-index:9999}
</style>
</head>
<body>
<div class="card">
  <div class="header">
    <div class="brandWrap"><img class="brand" src="logo.png" alt="logo" onerror="this.style.display='none'"></div>
    <div class="h1">ZBcoin â€“ Royal Flip</div>
    <div class="pill">Bakiye: <span id="bal">0</span> ZB</div>
    <div class="pill">GÃ¼nlÃ¼k Hak: <span id="left">3</span></div>
  </div>

  <div class="panel">
    <h3 class="title">ðŸŽ² Coin Flip</h3>

    <div class="stage">
      <div id="msg" class="msg">SeÃ§ â†’ FÄ±rlat</div>
      <div id="shadow" class="shadow"></div>

      <div class="coin" id="coin" aria-label="YazÄ±/Tura">
        <div class="face front">
          <div class="surface"><div class="label">YAZI</div><div class="sub">ZBcoin</div></div>
        </div>
        <div class="rim"></div>
        <div class="face back">
          <div class="surface"><div class="label">TURA</div><div class="sub">ZBcoin</div></div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:6px">
      <button class="btn" id="btnY">YazÄ±</button>
      <button class="btn" id="btnT">Tura</button>
      <button class="btn primary" id="btnThrow">FIRLAT</button>
    </div>

    <div class="center" style="min-height:36px;margin-top:8px;font-weight:800" id="result"></div>
  </div>

  <div class="footer">
    Adil RNG: <code>crypto.getRandomValues</code> â€¢ Haptics + WebAudio â€¢ Ultra 3D
  </div>
</div>

<script>
/* ====== OYUN DURUMU ====== */
const LS="zb_royal_flip_final";
const S = load() || { bal:0, left:3, pick:null };
function load(){ try{return JSON.parse(localStorage.getItem(LS)||"")}catch(_){return null} }
function save(){ localStorage.setItem(LS, JSON.stringify(S)); }

const balEl = document.getElementById('bal');
const leftEl= document.getElementById('left');
const resultEl=document.getElementById('result');
const coin = document.getElementById('coin');
const shadow=document.getElementById('shadow');
const msg = document.getElementById('msg');
const btnY = document.getElementById('btnY');
const btnT = document.getElementById('btnT');
const btnThrow = document.getElementById('btnThrow');

function render(){
  balEl.textContent = S.bal;
  leftEl.textContent= S.left;
  btnY.classList.toggle('ok', S.pick==="YAZI");
  btnT.classList.toggle('ok', S.pick==="TURA");
}
render();

/* ====== SES ====== */
const AC = window.AudioContext || window.webkitAudioContext; let actx=null;
function audioReady(){ if(!AC) return; if(!actx) actx=new AC(); }
function fxWhoosh(){ if(!actx) return;
  const o=actx.createOscillator(), g=actx.createGain();
  o.type='sawtooth'; o.frequency.setValueAtTime(180, actx.currentTime);
  o.frequency.exponentialRampToValueAtTime(60, actx.currentTime+0.6);
  g.gain.setValueAtTime(0.0001, actx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.28, actx.currentTime+0.08);
  g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.72);
  o.connect(g).connect(actx.destination); o.start(); o.stop(actx.currentTime+0.74);
}
function fxDing(){ if(!actx) return;
  const o=actx.createOscillator(), g=actx.createGain();
  o.type='triangle'; o.frequency.setValueAtTime(880, actx.currentTime);
  g.gain.setValueAtTime(0.0001, actx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.35, actx.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.5);
  o.connect(g).connect(actx.destination); o.start(); o.stop(actx.currentTime+0.52);
}

/* ====== ETKÄ°LEÅžÄ°M ====== */
btnY.onclick=()=>{ S.pick="YAZI"; save(); render(); msg.textContent="SeÃ§im: YAZI"; };
btnT.onclick=()=>{ S.pick="TURA"; save(); render(); msg.textContent="SeÃ§im: TURA"; };

btnThrow.onclick=()=>{
  audioReady();
  if(S.left<=0) return toast("GÃ¼nlÃ¼k hakkÄ±n bitti");
  if(!S.pick)   return toast("YazÄ± mÄ± Tura mÄ± seÃ§");
  spinOnce(S.pick);
};

let busy=false;
function spinOnce(choice){
  if(busy) return; busy=true; btnThrow.disabled=true;

  // Adil sonuÃ§
  const u32=new Uint32Array(1); crypto.getRandomValues(u32);
  const result = (u32[0]%2)===0 ? "YAZI" : "TURA";

  const baseTurns = 6 + Math.floor(Math.random()*3);
  const endDeg = result==="YAZI" ? baseTurns*360 : baseTurns*360 + 180;
  const dur = 1.7 + Math.random()*0.45;

  coin.classList.remove('anim','wobble','show-yazi','show-tura'); // ikisini de aÃ§Ä±k baÅŸlat
  coin.style.setProperty('--rotX', endDeg+'deg');
  coin.style.setProperty('--dur', dur+'s');
  void coin.offsetWidth;
  coin.classList.add('anim','spinning');
  msg.textContent="FÄ±rlatÄ±ldÄ±â€¦"; fxWhoosh(); navigator.vibrate?.(10);

  const t0=performance.now();
  (function raf(t){
    const k=Math.min(1,(t-t0)/(dur*1000));
    const s=1 + Math.sin(k*Math.PI)*0.3;
    shadow.style.transform=`scale(${s},${1/s})`;
    shadow.style.filter=`blur(${12+10*Math.sin(k*Math.PI)}px)`;
    if(k<1) requestAnimationFrame(raf);
  })(t0);

  setTimeout(()=>{
    coin.classList.remove('spinning'); coin.classList.add('wobble');
    coin.classList.add(result==="YAZI" ? 'show-yazi' : 'show-tura'); // gÃ¶rÃ¼nmeyen yÃ¼zÃ¼ gizle
    fxDing();
    S.left--; const win=(result===choice); if(win) S.bal+=5; save(); render();
    msg.textContent = result==="YAZI" ? "SonuÃ§: YAZI (Ã–N)" : "SonuÃ§: TURA (ARKA)";
    resultEl.textContent = win ? `ðŸŽ‰ DoÄŸru bildin! +5 ZB` : `ðŸ˜… YanlÄ±ÅŸ tahmin`;
    if(win) confetti(); navigator.vibrate?.(win?[20,40,20]:[12]);

    btnThrow.disabled=false; busy=false;
  }, dur*1000 + 40);
}

/* Confetti */
function confetti(){
  for(let i=0;i<80;i++){
    const d=document.createElement('div'); d.className='confetti';
    const hue=(i*13+Math.random()*60)|0; d.style.background=`hsl(${hue} 90% 60%)`;
    d.style.left=(Math.random()*100)+'vw'; document.body.appendChild(d);
    const fall=1400+Math.random()*1200, drift=(Math.random()*2-1)*200;
    d.animate([{transform:`translate(0,-20px) rotate(0)`},{transform:`translate(${drift}px, 100vh) rotate(${720*Math.random()+360}deg)`}],{duration:fall,easing:'cubic-bezier(.2,.7,.1,1)',fill:'forwards'});
    setTimeout(()=>d.remove(),fall+100);
  }
}

/* mini toast */
let tT=null; function toast(m){let el=document.getElementById('toast'); if(!el){el=document.createElement('div'); el.id='toast';
  el.style.position='fixed'; el.style.left='50%'; el.style.bottom='22px'; el.style.transform='translateX(-50%)';
  el.style.background='#12204b'; el.style.border='1px solid #ffffff20'; el.style.padding='10px 14px';
  el.style.borderRadius='10px'; el.style.boxShadow='0 10px 30px #0008'; el.style.fontWeight='800'; document.body.appendChild(el);}
  el.textContent=m; el.style.opacity='1'; clearTimeout(tT); tT=setTimeout(()=>el.style.opacity='0',1600);}
</script>
</body>
</html>
